<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detail Mesin | Feasbake</title>
  
  <link rel="stylesheet" href="style.css" />
  <style>
    /* ===================== OVERRIDE NAVBAR & CONTAINER ==================== */
    .navbar {
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      background-color: var(--brand-900); 
      z-index: var(--z-navbar);
    }
    
    .logo-default { display: none !important; }
    .logo-scrolled { opacity: 1 !important; visibility: visible !important; display: block !important; }

    .container {
      background: var(--neutral-50);
      padding: 120px 80px; /* Padding atas disesuaikan untuk navbar fixed */
      min-height: 100vh;
    }

    /* ===================== PRODUCT DETAIL LAYOUT ===================== */
    .product-detail-wrapper {
      display: grid;
      grid-template-columns: 45% 1fr; /* Kiri 45%, Kanan sisa */
      gap: 64px;
      align-items: start; /* Penting untuk Sticky */
    }

    /* --- LEFT COLUMN (VISUALS) --- */
    .detail-left {
      position: sticky;
      top: 100px; /* Jarak dari navbar saat scroll */
    }

    .main-image-wrapper {
      width: 100%;
      aspect-ratio: 1 / 1;
      background-color: white;
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 16px;
      border: 1px solid var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .main-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 24px;
      transition: opacity 0.3s ease;
    }

    .thumbnail-gallery {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .thumb-item {
      width: 80px;
      height: 80px;
      background-color: var(--neutral-50);
      border-radius: 8px;
      cursor: pointer;
      border: 1px solid var(--neutral-200);
      padding: 8px;
      opacity: 0.6; /* Default inactive opacity */
      transition: all 0.3s ease;
    }

    .thumb-item.active {
      opacity: 1;
      border-color: var(--brand-500);
      box-shadow: 0 0 0 2px var(--brand-100);
    }

    .thumb-item:hover {
      opacity: 1;
    }

    .thumb-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* --- RIGHT COLUMN (CARDS STACK) --- */
    .detail-right {
      display: flex;
      flex-direction: column;
      gap: 24px;
      width: 100%;
    }

    /* Common Card Style */
    .detail-card {
      background-color: var(--neutral-100);
      border-radius: 16px;
      padding: 32px;
      height: fit-content;
    }

    /* Card 1: Main Info */
    .product-title {
      font-size: var(--body-xl);
      color: var(--text-primary);
      font-weight: 700;
      margin-bottom: 8px;
    }

    .product-price {
      font-size: var(--h5-size);
      color: var(--brand-500);
      font-weight: 700;
      margin-bottom: 24px;
    }

    .action-row {
      display: flex;
      gap: 16px;
      align-items: stretch;
    }

    /* Quantity Selector */
    .qty-selector {
      display: flex;
      align-items: center;
      background-color: var(--neutral-200); /* Sesuai request */
      border-radius: 8px;
      padding: 4px;
    }

    .qty-btn {
      width: 40px;
      height: 48px; /* Samakan tinggi dengan primary button */
      border: none;
      background: transparent;
      color: var(--text-primary);
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .qty-input {
      width: 40px;
      text-align: center;
      background: transparent;
      border: none;
      font-weight: 700;
      color: var(--text-primary);
      font-size: 16px;
    }

    .btn-add-cart {
      flex: 1; /* Fill remaining width */
      justify-content: center;
    }

    /* Card 2-4: Accordion Cards */
    .accordion-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }

    .accordion-title {
      font-size: var(--body-l);
      color: var(--text-primary);
      font-weight: 700;
    }

    .accordion-icon {
      width: 24px;
      height: 24px;
      position: relative;
      transition: transform 0.3s ease;
    }
    
    /* Membuat tanda + dengan CSS agar mudah dianimasikan */
    .accordion-icon::before,
    .accordion-icon::after {
      content: '';
      position: absolute;
      background-color: var(--text-primary);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border-radius: 2px;
    }
    
    .accordion-icon::before { width: 2px; height: 16px; } /* Garis vertikal */
    .accordion-icon::after { width: 16px; height: 2px; } /* Garis horizontal */

    /* Animasi + jadi X */
    .detail-card.active .accordion-icon {
      transform: rotate(45deg); /* Putar 45 derajat */
    }

    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, margin-top 0.4s ease;
      font-size: var(--body-m);
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .detail-card.active .accordion-content {
      max-height: 500px; /* Angka cukup besar untuk menampung konten */
      margin-top: 16px;
    }

    /* Card 5: Similar Products */
    .similar-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-top: 16px;
    }

    .similar-item {
      position: relative;
      aspect-ratio: 1 / 1;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
    }

    .similar-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .similar-item:hover .similar-img {
      transform: scale(1.05);
    }

    /* White Overlay for Text */
    .similar-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.9); /* White overlay */
      padding: 12px;
      text-align: center;
    }

    .similar-title {
      font-size: var(--body-l);
      color: var(--text-primary);
      font-weight: 600;
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* RESPONSIVE */
    @media (max-width: 1024px) {
      .container { padding: 100px 40px; }
      .product-detail-wrapper { gap: 40px; }
    }

    @media (max-width: 768px) {
      .product-detail-wrapper {
        grid-template-columns: 1fr; /* Stack layout */
      }
      .detail-left {
        position: static; /* Hilangkan sticky di mobile */
      }
      .similar-grid {
        grid-template-columns: 1fr; /* 1 produk per baris di HP */
      }
    }
  </style>
</head>

<body>
  <nav class="navbar" id="mainNavbar">
    <div class="navbar-container">
      <a href="index.html" class="logo">
        <svg class="logo-scrolled" width="98" height="40" viewBox="0 0 98 40" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="98" height="40" rx="20" fill="#FAFAFA"/>
            <path d="M33.1538 9.53979C33.9299 9.53979 34.706 9.53979 35.503 9.53979C35.5106 9.65847 35.5204 9.74115 35.5205 9.82385C35.5214 11.3702 35.5236 12.9165 35.515 14.4628C35.5145 14.5562 35.4257 14.649 35.3252 14.7428C35.2237 14.7461 35.175 14.7488 35.0964 14.7471C33.5518 14.7451 32.037 14.7474 30.4949 14.7459C30.4123 14.7456 30.3571 14.7492 30.2732 14.7488C29.4704 14.7447 28.6963 14.7447 27.9138 14.7447C27.9138 15.9228 27.9138 17.072 27.9138 18.2396C29.0145 18.2396 30.1013 18.2396 31.2101 18.2438C31.2769 18.2447 31.3217 18.2416 31.3963 18.2432C32.785 18.2479 34.1437 18.2479 35.5514 18.2479C35.5514 19.5259 35.5514 20.7655 35.5427 22.0347C35.5321 22.1916 35.5377 22.3196 35.5268 22.4461C35.5077 22.6706 35.4786 22.8942 35.4236 23.1134C33.965 23.1141 32.5364 23.1196 31.0852 23.1191C31.0315 23.1154 31.0005 23.1176 30.9398 23.1139C29.9097 23.1079 28.9093 23.1079 27.8998 23.1079C27.8998 24.0715 27.8976 24.9903 27.9003 25.9091C27.9036 27.0005 27.911 28.092 27.9128 29.2066C27.9134 29.2918 27.9178 29.354 27.9163 29.4461C27.9105 30.1476 27.9105 30.8192 27.9105 31.4908C27.8712 31.5014 27.832 31.5121 27.7928 31.5227C27.5139 31.1384 27.2351 30.7541 26.954 30.3522C26.9301 30.3078 26.9084 30.2809 26.8825 30.2322C25.9895 28.9064 25.1008 27.6026 24.2089 26.2818C24.1767 26.2305 24.1476 26.196 24.1105 26.1398C22.8755 24.3001 21.6512 22.4804 20.4178 20.6669C20.2913 20.481 20.2785 20.3511 20.4122 20.1587C21.041 19.2537 21.6551 18.3384 22.2699 17.4238C22.9864 16.3577 23.6982 15.2884 24.4288 14.2102C24.4633 14.1654 24.4812 14.131 24.5167 14.0843C25.2052 13.0831 25.8781 12.0955 26.546 11.1045C26.7559 10.7932 26.9525 10.4729 27.1719 10.1452C27.2169 10.0892 27.2454 10.0447 27.291 9.98696C27.4653 9.74982 27.6222 9.52596 27.7551 9.33655C27.9103 9.42952 28.0141 9.54556 28.1185 9.5461C29.7195 9.55429 31.3206 9.54743 32.9505 9.5481C33.0375 9.54801 33.0956 9.5439 33.1538 9.53979Z" fill="#002266"/>
            </svg>
      </a>

      <div class="nav-menu">
        <a href="index.html" class="nav-link">BERANDA</a>
        <a href="machine.html" class="nav-link active">MESIN</a>
        <a href="#" class="nav-link">TENTANG KAMI</a>
        <a href="#" class="nav-link">RESEP</a>
        <a href="#" class="nav-link">ARTIKEL</a>
      </div>

      <div class="nav-actions">
        <a href="#" class="nav-link nav-link-contact">HUBUNGI KAMI</a>
        <button class="nav-btn" id="cartBtn">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.875 16.875C7.22018 16.875 7.5 16.5952 7.5 16.25C7.5 15.9048 7.22018 15.625 6.875 15.625C6.52982 15.625 6.25 15.9048 6.25 16.25C6.25 16.5952 6.52982 16.875 6.875 16.875Z" stroke="#FAFAFA" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/><path d="M15.625 16.875C15.9702 16.875 16.25 16.5952 16.25 16.25C16.25 15.9048 15.9702 15.625 15.625 15.625C15.2798 15.625 15 15.9048 15 16.25C15 16.5952 15.2798 16.875 15.625 16.875Z" stroke="#FAFAFA" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/><path d="M1.875 3.125H4.375L6.25 13.75H16.25" stroke="#FAFAFA" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/><path d="M6.25 11.25H15.9937C16.066 11.2501 16.1361 11.225 16.192 11.1793C16.2479 11.1335 16.2862 11.0697 16.3004 10.9988L17.4254 5.37383C17.4345 5.32847 17.4334 5.28166 17.4222 5.23678C17.4109 5.19191 17.3899 5.15008 17.3606 5.11431C17.3312 5.07855 17.2943 5.04974 17.2525 5.02997C17.2107 5.0102 17.165 4.99997 17.1187 5H5" stroke="#FAFAFA" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span class="cart-badge" id="cartCount">0</span>
        </button>
        <button class="nav-btn mobile-only-btn" id="menuBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
        </button>
      </div>
    </div>
  </nav>

  <div class="mobile-menu-overlay" id="mobileMenu">
    </div>

  <div class="overlay" id="cartOverlay"></div>
  <aside class="cart-sidebar" id="cartSidebar">
    <div class="cart-header">
        <span class="body-xl" style="font-weight: 700;">Keranjang</span>
        <button id="closeCart" style="background:none; border:none; cursor:pointer;">X</button>
    </div>
    <div class="cart-items" id="cartItemsContainer"></div>
    <div class="cart-footer">
        <div class="flex-between"><span>Total</span><h6 id="cartTotalPrice">Rp0</h6></div>
    </div>
  </aside>

  <main>
    <section class="container">
      <div class="product-detail-wrapper" id="productDetailContainer">
        </div>
    </section>
  </main>

  <footer id="main-footer">
    <div class="footer-container">
        <div class="footer-top"><div class="footer-logo"></div></div>
    </div>
  </footer>

  <script src="productData.js"></script>
  <script src="cart.js"></script>
  <script>
    // --- JS LOGIC FOR PRODUCT DETAIL ---
    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const productId = parseInt(urlParams.get('id'));
        const container = document.getElementById('productDetailContainer');

        const product = products.find(p => p.id === productId);

        if (!product) {
            container.innerHTML = '<h2>Produk tidak ditemukan.</h2>';
            return;
        }

        // Ambil gambar (jika array kosong atau string, handle fallback)
        let imageList = Array.isArray(product.images) && product.images.length > 0 
            ? product.images 
            : [product.image]; // Fallback ke property lama jika ada

        // RENDER HTML STRUCTURE
        container.innerHTML = `
            <div class="detail-left">
                <div class="main-image-wrapper">
                    <img src="${imageList[0]}" alt="${product.name}" class="main-image" id="mainImage">
                </div>
                <div class="thumbnail-gallery" id="thumbnailGallery">
                    </div>
            </div>

            <div class="detail-right">
                
                <div class="detail-card">
                    <h1 class="product-title">${product.name}</h1>
                    <div class="product-price">${formatRupiah(product.price)}</div>
                    
                    <div class="action-row">
                        <div class="qty-selector">
                            <button class="qty-btn" onclick="updateQty(-1)">-</button>
                            <input type="text" class="qty-input" id="qtyValue" value="1" readonly>
                            <button class="qty-btn" onclick="updateQty(1)">+</button>
                        </div>
                        <button class="btn-primary btn-add-cart" onclick="addToCartDetailed(${product.id})">
                            MASUKKAN KERANJANG
                        </button>
                    </div>
                </div>

                <div class="detail-card" onclick="toggleAccordion(this)">
                    <div class="accordion-header">
                        <span class="accordion-title">Deskripsi</span>
                        <div class="accordion-icon"></div>
                    </div>
                    <div class="accordion-content">
                        <p>${product.description || "Tidak ada deskripsi."}</p>
                    </div>
                </div>

                <div class="detail-card" onclick="toggleAccordion(this)">
                    <div class="accordion-header">
                        <span class="accordion-title">Spesifikasi</span>
                        <div class="accordion-icon"></div>
                    </div>
                    <div class="accordion-content">
                        <p>Placeholder: Dimensi, Daya Listrik, Kapasitas, Berat Mesin.</p>
                    </div>
                </div>

                <div class="detail-card" onclick="toggleAccordion(this)">
                    <div class="accordion-header">
                        <span class="accordion-title">Pengiriman</span>
                        <div class="accordion-icon"></div>
                    </div>
                    <div class="accordion-content">
                        <p>Placeholder: Gratis ongkir wilayah Jakarta. Pengiriman luar kota menggunakan ekspedisi rekanan.</p>
                    </div>
                </div>

                <div class="detail-card">
                    <span class="accordion-title">Produk Serupa</span>
                    <div class="similar-grid" id="similarContainer">
                        </div>
                </div>

            </div>
        `;

        // --- RENDER THUMBNAILS ---
        const thumbContainer = document.getElementById('thumbnailGallery');
        imageList.forEach((imgSrc, index) => {
            // Maksimal 2 thumbnail sesuai request
            if(index > 1) return; 

            const thumb = document.createElement('div');
            thumb.className = `thumb-item ${index === 0 ? 'active' : ''}`;
            thumb.innerHTML = `<img src="${imgSrc}" class="thumb-img">`;
            
            thumb.addEventListener('click', () => {
                // Change main image
                const mainImg = document.getElementById('mainImage');
                mainImg.style.opacity = 0;
                setTimeout(() => {
                    mainImg.src = imgSrc;
                    mainImg.style.opacity = 1;
                }, 150);

                // Update active state
                document.querySelectorAll('.thumb-item').forEach(t => t.classList.remove('active'));
                thumb.classList.add('active');
            });

            thumbContainer.appendChild(thumb);
        });

        // --- RENDER SIMILAR PRODUCTS ---
        const similarContainer = document.getElementById('similarContainer');
        const similarProducts = products
            .filter(p => p.category === product.category && p.id !== product.id)
            .slice(0, 2); // Max 2 item

        if(similarProducts.length === 0) {
            similarContainer.innerHTML = '<p class="body-s">Tidak ada produk serupa.</p>';
        } else {
            similarProducts.forEach(sim => {
                const img = Array.isArray(sim.images) ? sim.images[0] : sim.image;
                similarContainer.innerHTML += `
                    <div class="similar-item" onclick="window.location.href='product-detail.html?id=${sim.id}'">
                        <img src="${img}" class="similar-img">
                        <div class="similar-overlay">
                            <h6 class="similar-title">${sim.name}</h6>
                        </div>
                    </div>
                `;
            });
        }
    });

    // --- LOGIC FUNCTIONS ---
    
    // Accordion Toggle
    function toggleAccordion(card) {
        card.classList.toggle('active');
    }

    // Quantity Logic
    function updateQty(change) {
        const input = document.getElementById('qtyValue');
        let val = parseInt(input.value);
        val += change;
        if(val < 1) val = 1;
        input.value = val;
    }

    // Custom Add to Cart with Quantity
    function addToCartDetailed(id) {
        const qty = parseInt(document.getElementById('qtyValue').value);
        // Panggil fungsi addToCart dari cart.js sebanyak qty kali 
        // (Atau modifikasi cart.js untuk terima qty, tapi cara loop ini works dengan cart.js yang ada)
        for(let i=0; i<qty; i++) {
            addToCart(id); 
        }
        // Buka sidebar cart
        document.getElementById('cartBtn').click();
    }

    // --- STANDARD NAVBAR LOGIC ---
    const cartBtn = document.getElementById('cartBtn');
    const cartSidebar = document.getElementById('cartSidebar');
    const cartOverlay = document.getElementById('cartOverlay');
    const closeCart = document.getElementById('closeCart');
    const menuBtn = document.getElementById('menuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    const navbar = document.getElementById('mainNavbar');

    if(cartBtn) {
        cartBtn.addEventListener('click', () => {
            cartSidebar.classList.add('active');
            cartOverlay.classList.add('active');
            navbar.classList.add('cart-open');
            if (typeof renderCartItems === 'function') renderCartItems();
        });
    }
    
    [closeCart, cartOverlay].forEach(el => {
        if(el) {
            el.addEventListener('click', () => {
                cartSidebar.classList.remove('active');
                cartOverlay.classList.remove('active');
                navbar.classList.remove('cart-open');
            });
        }
    });

    if(menuBtn) {
        menuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('active');
            navbar.classList.toggle('menu-open');
        });
    }
  </script>
</body>
</html>
